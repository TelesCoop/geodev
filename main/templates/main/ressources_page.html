{% extends "base.html" %}
{% load static %}
{% load wagtailcore_tags %}
{% load wagtailimages_tags %}
{% load main_tags %}

{% block content %}
  <div class="container pt-3">
    {% include "components/breadcrumbs.html" %}

    <h1 class="title is-1">Les ressources</h1>
  </div>
  <div id="app">
    <div class="section has-background-secondary-light">
      <div class="container">
        <h2 class="title is-3">Ma recherche</h2>
        <div class="columns">
          <div class="column is-4 i-am-profiles">
            <h3 class="title is-4">Je suis</h3>
            <template v-if="selectedProfile">
              <button class="button is-rounded is-secondary">[[ profiles[selectedProfile].name ]]</button>
            </template>
            <template v-else>
              <button v-for="profile in profiles" class="button is-rounded is-secondary is-outlined"
                      @click="selectProfile(profile.slug)">
                [[ profile.name ]]
              </button>
            </template>
            <div class="mt-2">
              <button class="button is-primary" @click="selectProfile('')">
                <span class="icon">
                  {% include "components/icon.html" with size="16" name="settings-2" %}
                </span>
                <span>Changer de profil</span>
              </button>
            </div>
            <h3 class="title is-4">Les ressources qui m'intéressent</h3>
            Par défaut, nous vous proposerons des <span>produits, documents et projets</span>.
            <div class="mt-2">
              <button class="button is-primary">
                <span class="icon">
                  {% include "components/icon.html" with size="16" name="settings-2" %}
                </span>
                <span>Personnaliser</span>
              </button>
            </div>
          </div>
          <div class="column is-4">
            <h3 class="title is-4">Les thématiques qui m'intéressent</h3>
            <div class="elements-holder">
              <button v-for="thematic in thematics" class="button is-rounded"
                      :class="'is-' + thematic.slug + ' ' + (selectedThematics[thematic.slug] ? '' : 'is-outlined')"
                      @click="toggleThematic(thematic.slug)">
              <span class="icon">
                  <img :src="'{% static 'img/thematics' %}' + '/' + thematic.slug + '.svg'">
                </span>
                <span>[[ thematic.name ]]</span>
              </button>
            </div>
          </div>
          <div class="column is-4">
            <h3 class="title is-4">Les zones qui m'intéressent</h3>
            <div class="elements-holder">
              <button v-for="zone in zones" class="button is-rounded is-secondary"
                      :class="selectedZones[zone.slug] ? '' : 'is-outlined'"
                      @click="toggleZone(zone.slug)">
              <span class="icon">
                  <img :src="'{% static 'img/zones' %}' + '/' + zone.slug + '.svg'">
                </span>
                <span>[[ zone.name ]]</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

{% endblock content %}

{% block extra_js %}
  <script>
      var thematics = JSON.parse('{{ thematics | escapejs }}');
      var selectedThematics = {};
      thematics.forEach(function (thematic) {
          selectedThematics[thematic.slug] = false
      });
      var zones = JSON.parse('{{ zones | escapejs }}');
      var selectedZones = {};
      zones.forEach(function (zone) {
          selectedZones[zone.slug] = false
      });

      Vue.createApp({
          delimiters: ['[[', ']]'],
          data() {
              return {
                  profiles: JSON.parse('{{ profiles | escapejs }}'),
                  thematics: thematics,
                  zones: zones,
                  selectedProfile: '{{ selected_profile }}',
                  selectedThematics: selectedThematics,
                  selectedZones: selectedZones,
              }
          },
          methods: {
              selectProfile(profile) {
                  this.selectedProfile = profile;
              },
              toggleThematic(thematic) {
                  this.selectedThematics[thematic] = !this.selectedThematics[thematic];
              },
              toggleZone(zone) {
                  this.selectedZones[zone] = !this.selectedZones[zone];
              },
          },
      }).mount('#app')
  </script>
{% endblock extra_js %}

{% block extra_css %}
  <style>
      .i-am-profiles .button + .button {
          margin-left: 8px;
      }

      .elements-holder {
          margin-top: -10px;
          margin-left: -16px;
      }

      .elements-holder > * {
          margin-top: 10px;
          margin-left: 16px;
      }
  </style>
{% endblock %}
